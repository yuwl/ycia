<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.thinkgem.jeesite.modules.agent.dao.AgentClentDao">
    
	<sql id="agentClentColumns">
		a.id AS "id",
		a.agent_id AS "agentId",
		a.client_name AS "clientName",
		a.client_type AS "clientType",
		a.phone AS "phone",
		a.address AS "address",
		a.postcode AS "postcode",
		a.email AS "email",
		a.card_type AS "cardType",
		a.card_no AS "cardNo",
		a.photo_front AS "photoFront",
		a.photo_back AS "photoBack",
		a.create_time AS "createTime",
		a.create_by AS "createBy",
		a.update_time AS "updateTime",
		a.update_by AS "updateBy",
		a.del_flag AS "delFlag",
		a.remarks AS "remarks",
		a.user_id AS "userId"
	</sql>
	
	<sql id="agentClentJoins">
	</sql>
    
	<select id="get" resultType="AgentClent">
		SELECT 
			<include refid="agentClentColumns"/>
		FROM agent_clent a
		<include refid="agentClentJoins"/>
		WHERE a.id = #{id}
	</select>
	
	<select id="findList" resultType="com.thinkgem.jeesite.modules.agent.entity.AgentClentR">
		SELECT 
		ag.name AS "agentName",
			<include refid="agentClentColumns"/>
			
		FROM agent_clent a left outer join agent ag on a.agent_id= ag.id
 		<include refid="agentClentJoins"/>
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
			<if test="agentId != null and agentId != ''">
				<!--AND a.agent_id IN (select age.id from agent age where age.name = #{agentId})-->
				AND a.agent_id = #{agentId} 
			</if>
			<if test="clientName != null and clientName != ''">
				AND a.client_name = #{clientName}
			</if>
			<if test="clientType != null and clientType != ''">
				AND a.client_type = #{clientType}
			</if>
			<if test="phone != null and phone != ''">
				AND a.phone = #{phone}
			</if>

			
		</where>
		ORDER BY a.update_time DESC
	</select>
	
	<select id="findAllList" resultType="AgentClent">
		SELECT 
			<include refid="agentClentColumns"/>
		FROM agent_clent a
		<include refid="agentClentJoins"/>
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
		</where>		
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
			</otherwise>
		</choose>
	</select>
	
	<insert id="insert">
		INSERT INTO agent_clent(
			id, 
			agent_id,
			client_name,
			client_type,
			phone,
			address,
			postcode,
			email,
			card_type,
			card_no,
			photo_front,
			photo_back,
			create_time,
			create_by,
			update_time,
			update_by,
			del_flag,
			remarks,
			user_id
		) VALUES (
			#{id},
			#{agentId},
			#{clientName},
			#{clientType},
			#{phone},
			#{address},
			#{postcode},
			#{email},
			#{cardType},
			#{cardNo},
			#{photoFront},
			#{photoBack},
			#{createDate},
			#{createBy.name},
			#{updateDate},
			#{updateBy.name},
			#{delFlag},
			#{remarks},
			#{userId}
		)
	</insert>
	
	<update id="update">
		UPDATE agent_clent SET 	
			agent_id = #{agentId},
			client_name = #{clientName},
			client_type = #{clientType},
			phone = #{phone},
			address = #{address},
			postcode = #{postcode},
			email = #{email},
			card_type = #{cardType},
			card_no = #{cardNo},
			photo_front = #{photoFront},
			photo_back = #{photoBack},
			update_time = #{updateDate},
			update_by = #{updateBy.name},
			remarks = #{remarks},
			user_id = #{userId}
		WHERE id = #{id}
	</update>
	
	<update id="delete">
		UPDATE agent_clent SET 
			del_flag = #{DEL_FLAG_DELETE}
		WHERE id = #{id}
	</update>
</mapper>